
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PSCodec &#8212; PSCodec 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Encoder" href="encoder.html" />
    <link rel="prev" title="Welcome to PSCodec’s documentation!" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="pscodec">
<h1>PSCodec<a class="headerlink" href="#pscodec" title="Permalink to this headline">¶</a></h1>
<p>The codec comprises an encoder and a decoder. The former takes an array of
samples as an input and outputs a URL. The latter performs the reverse
operation; it takes the URL as an input and outputs an array of samples,
in the same order as supplied to the encoder.</p>
<p>The sample arrays are ordered from the most recent at the top (element 0) to the oldest.</p>
<div class="section" id="measurands-to-samples">
<h2>Measurands to Samples<a class="headerlink" href="#measurands-to-samples" title="Permalink to this headline">¶</a></h2>
<p>The length of the URL is configurable. It should be fairly long (1 KB) to hold
a large number of samples. The codec can be configured so that each sample
contains either one or two 12-bit measurands. For Plotsensor, these are
temperature and relative humidity.</p>
</div>
<div class="section" id="samples-to-chunks">
<h2>Samples to Chunks<a class="headerlink" href="#samples-to-chunks" title="Permalink to this headline">¶</a></h2>
<p>The encoder starts at the oldest sample and groups input data into 6 byte chunks.
Byte 0 of the chunk contains the oldest data and Byte 5 contains the newest.
Each chunk contains two samples, assuming there are two measurands per sample.</p>
<p>The chunk containing the most recent data can be partially full.
In this case it is padded with samples that contain ‘0’. The number of samples
is written to the Length field in the endstop of the URL.
With this information the decoder discards the samples used for padding.</p>
</div>
<div class="section" id="chunks-to-octets">
<h2>Chunks to Octets<a class="headerlink" href="#chunks-to-octets" title="Permalink to this headline">¶</a></h2>
<p>Chunks are base64 encoded using only URL-safe characters.
This produces a list of 8-byte values, which are named Octets.</p>
</div>
<div class="section" id="circular-buffer">
<h2>Circular Buffer<a class="headerlink" href="#circular-buffer" title="Permalink to this headline">¶</a></h2>
<p>Octets are placed onto a circular buffer.
The end of the buffer is marked by an <a class="reference internal" href="#endstop">endstop</a>. Immediately to the left of
the endstop is the Octet containing the most recent sample data.
The octet to the right contains the oldest sample data.</p>
</div>
<div class="section" id="timestamps">
<h2>Timestamps<a class="headerlink" href="#timestamps" title="Permalink to this headline">¶</a></h2>
<p>A feature of PSCodec is that each sample does not include an absolute timestamp.
There is an RTC on the PSHardware, but it is only used to measure
time intervals of one minute.</p>
<p>Without the requirement for absolute time,
the user is not burdened with setting it like they have to on a wristwatch
or a cooker.</p>
<p>Instead PSCodec provides all necessary information for sample timestamps
to be reconstructed based on:</p>
<ul class="simple">
<li>Now (UTC), the time the PSCodec URL is received by PSWebApp. This coincides
with the time the sensor is scanned by a phone.</li>
<li>Minutes elapsed. The time difference between Now (UTC) and when the most
recent sample was taken.</li>
<li>Time interval in minutes between samples. This is a constant time interval
between all samples in the buffer.</li>
</ul>
<p>The reconstructed timestamps will be accurate to within one minute, which is
sufficient for most datalogging applications.</p>
</div>
<div class="section" id="endstop">
<h2>Endstop<a class="headerlink" href="#endstop" title="Permalink to this headline">¶</a></h2>
<p>The endstop is 16-bits wide. It contains 4 elements.</p>
<div class="section" id="minutes-elapsed-base64-and-end-marker">
<h3>Minutes elapsed (base64) and end marker<a class="headerlink" href="#minutes-elapsed-base64-and-end-marker" title="Permalink to this headline">¶</a></h3>
<p>The minutes elapsed counter increments by 1 every minute after the last sample
was collected. It resets to 0 when a new sample is collected i.e. when it is
equal to time interval.</p>
<p>The unencoded minutes elapsed field is 16-bits wide. This is the same width
as the unencoded time interval in minutes field.</p>
<p>The minutes elapsed field occupies 4 bytes after base64 encoding, including one
padding byte. By convention this is 0x61 or ‘=’.</p>
<p>The encoder replaces the padding byte with 0x01 or ‘!’.
This is the end marker; the last byte of the end stop in the circular buffer.
The URL-safe character will be unique in the circular buffer.</p>
<p>Locating the end marker is the first step performed by the decoder. After it is
found, it can be replaced with an ‘=’ before the minutes elapsed field is
decoded from base64 into the original 16-bit value.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">PSCodec</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">PSCodec</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#measurands-to-samples">Measurands to Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#samples-to-chunks">Samples to Chunks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#chunks-to-octets">Chunks to Octets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#circular-buffer">Circular Buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timestamps">Timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#endstop">Endstop</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="encoder.html">Encoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="decoder.html">Decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Test</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">Welcome to PSCodec’s documentation!</a></li>
      <li>Next: <a href="encoder.html" title="next chapter">Encoder</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Malcolm Mackay.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/docs/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>